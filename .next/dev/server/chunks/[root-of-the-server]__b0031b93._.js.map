{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/davilaacostarenzojhair/DESARROLLO/Nyutku%20Systems/parroquia-icm-nextjs/src/app/api/upload/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { writeFile, mkdir } from 'fs/promises';\nimport path from 'path';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const formData = await request.formData();\n    const file = formData.get('file') as File;\n    const folder = (formData.get('folder') as string) || 'general'; // banners, services, gallery, etc.\n    \n    if (!file) {\n      return NextResponse.json(\n        { success: false, error: 'No se proporcionó ningún archivo' },\n        { status: 400 }\n      );\n    }\n\n    // Validar tipo de archivo\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp', 'image/gif'];\n    if (!allowedTypes.includes(file.type)) {\n      return NextResponse.json(\n        { success: false, error: 'Tipo de archivo no permitido. Solo se permiten imágenes.' },\n        { status: 400 }\n      );\n    }\n\n    // Validar tamaño (10MB max)\n    const maxSize = 10 * 1024 * 1024; // 10MB\n    if (file.size > maxSize) {\n      return NextResponse.json(\n        { success: false, error: 'El archivo es demasiado grande. Máximo 10MB.' },\n        { status: 400 }\n      );\n    }\n\n    // Generar nombre único\n    const bytes = await file.arrayBuffer();\n    const buffer = Buffer.from(bytes);\n    \n    const timestamp = Date.now();\n    const randomString = Math.random().toString(36).substring(2, 8);\n    const extension = file.name.split('.').pop();\n    const filename = `${timestamp}-${randomString}.${extension}`;\n\n    // Crear directorio si no existe\n    const uploadDir = path.join(process.cwd(), 'public', 'uploads', folder);\n    try {\n      await mkdir(uploadDir, { recursive: true });\n    } catch (error) {\n      // El directorio ya existe\n    }\n\n    // Guardar archivo\n    const filepath = path.join(uploadDir, filename);\n    await writeFile(filepath, buffer);\n\n    // Retornar URL pública\n    const publicUrl = `/uploads/${folder}/${filename}`;\n\n    return NextResponse.json({\n      success: true,\n      url: publicUrl,\n      filename,\n      size: file.size,\n      type: file.type,\n    });\n  } catch (error) {\n    console.error('Error al subir archivo:', error);\n    return NextResponse.json(\n      { success: false, error: 'Error al subir el archivo' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,WAAW,MAAM,QAAQ,QAAQ;QACvC,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,MAAM,SAAS,AAAC,SAAS,GAAG,CAAC,aAAwB,WAAW,mCAAmC;QAEnG,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAmC,GAC5D;gBAAE,QAAQ;YAAI;QAElB;QAEA,0BAA0B;QAC1B,MAAM,eAAe;YAAC;YAAc;YAAa;YAAa;YAAc;SAAY;QACxF,IAAI,CAAC,aAAa,QAAQ,CAAC,KAAK,IAAI,GAAG;YACrC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAA2D,GACpF;gBAAE,QAAQ;YAAI;QAElB;QAEA,4BAA4B;QAC5B,MAAM,UAAU,KAAK,OAAO,MAAM,OAAO;QACzC,IAAI,KAAK,IAAI,GAAG,SAAS;YACvB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAA+C,GACxE;gBAAE,QAAQ;YAAI;QAElB;QAEA,uBAAuB;QACvB,MAAM,QAAQ,MAAM,KAAK,WAAW;QACpC,MAAM,SAAS,OAAO,IAAI,CAAC;QAE3B,MAAM,YAAY,KAAK,GAAG;QAC1B,MAAM,eAAe,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,GAAG;QAC7D,MAAM,YAAY,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG;QAC1C,MAAM,WAAW,GAAG,UAAU,CAAC,EAAE,aAAa,CAAC,EAAE,WAAW;QAE5D,gCAAgC;QAChC,MAAM,YAAY,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU,WAAW;QAChE,IAAI;YACF,MAAM,IAAA,8HAAK,EAAC,WAAW;gBAAE,WAAW;YAAK;QAC3C,EAAE,OAAO,OAAO;QACd,0BAA0B;QAC5B;QAEA,kBAAkB;QAClB,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,WAAW;QACtC,MAAM,IAAA,kIAAS,EAAC,UAAU;QAE1B,uBAAuB;QACvB,MAAM,YAAY,CAAC,SAAS,EAAE,OAAO,CAAC,EAAE,UAAU;QAElD,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,KAAK;YACL;YACA,MAAM,KAAK,IAAI;YACf,MAAM,KAAK,IAAI;QACjB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAA4B,GACrD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}